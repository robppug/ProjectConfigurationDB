<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[SM] Project Configurations</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/styles.css') }}">
</head>
<body class="bg-light">
    {% import '_options.html' as options %}
    {% import '_macros.html' as macro %}
    <div class="container-fluid px-5 py-4" style="max-width: 95vw;">
        <!-- Page Title Row -->
        <div class="mb-3">
            <h1 class="h3 text-primary mb-0">[SM] Project Configurations</h1>
        </div>

        <!-- Actions Row (Add New + Settings) -->
        <div class="d-flex align-items-center mb-3">
            <a href="{{ url_for('add') }}" class="btn btn-primary me-3">Add New</a>
            <a href="{{ url_for('settings') }}" class="settings-link" title="Settings">&#9881;</a>
            <button id="showLogsButton" class="btn btn-secondary" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;">Logs</button>
        </div>

        <div id="logPanel" style="position: fixed; bottom: 80px; right: 20px; width: 800px; height: 250px;
                                  background: rgba(0, 0, 0, 0.45); color: white; font-size: 12px;
                                  padding: 10px; overflow-y: auto; display: none; z-index: 10000;
                                  border-radius: 5px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">Logs
                <button onclick="clearLogs()" class="btn btn-sm btn-danger">Clear</button>
            </div>
            <div id="logContent" style="max-height: 200px; overflow-y: auto;"></div>
        </div>

        {% include '_messages.html' %}

        <div class="card shadow-sm">
            <div class="card-body p-0">
                <div class="table-responsive w-100">
                    <table class="table table-hover mb-0 w-100">
                        <thead class="table-primary">
                            <!-- Main header row with sortable columns -->
                            <tr id="headerRow">
                                <th class="sortable" style="width: 40px; white-space: nowrap;">
                                    #
                                    <span class="sort-icon"></span>
                                </th>
                                <th class="sortable" style="width: 150px; white-space: nowrap;">
                                    Project
                                    <span class="sort-icon"></span>
                                </th>
                                <th class="sortable" style="width: 150px; white-space: nowrap;">
                                    Stage
                                    <span class="sort-icon"></span>
                                </th>
                                <th class="sortable" style="width: 200px; white-space: nowrap;">
                                    Last Updated
                                    <span class="sort-icon"></span>
                                </th>
                                <th class="sortable" style="width: 800px; white-space: nowrap;">
                                    Description
                                    <span class="sort-icon"></span>
                                </th>
                                <th style="width: 150px;">Actions</th>
                            </tr>
                            <!-- Filter row -->
                            <tr>
                                <th></th>
                                <th>
                                    <input type="text" class="form-control form-control-sm column-filter" data-column="1" placeholder="Filter Project">
                                </th>
                                <th>
                                    <select id="stageFilter" class="form-control form-control-sm column-filter" data-column="2">
                                        <option value="">All Stages</option>
                                        {% for field, stage, btn_class in options.project_stages %}
                                        <option value="{{ stage }}">{{ stage }}</option>
                                        {% endfor %}
                                    </select>
                                </th>
                                <th>
                                    <input type="text" class="form-control form-control-sm column-filter" data-column="3" placeholder="Filter Date">
                                </th>
                                <th></th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for project in projects %}
                            <tr class="main-row align-middle cursor-pointer" data-bs-toggle="collapse" data-bs-target="#details-{{ project.id }}">
                                <td class="fw-semibold">{{ project.id }}</td>
                                <td>{{ project.project }}</td>
                                <td>
                                    <span class="badge bg-{% if project.project_stage == 'ACTIVE' %}success{% elif project.project_stage == 'PLATFORM' %}warning{% elif project.project_stage == 'TLS' %}danger{% elif project.project_stage == 'RFI' %}primary{% elif project.project_stage == 'RFQ' %}secondary{% else %}info{% endif %}">
                                        {{ project.project_stage or 'N/A' }}
                                    </span>
                                </td>
                                <td>{{ project.last_updated or '-' }}</td>
                                <td>{{ project.description or '' }}</td>
                                <td>
                                    <form action="{{ url_for('delete', id=project.id) }}" method="POST">
                                        <input type="hidden" name="_method" value="DELETE">
                                        <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure?')">
                                            Delete
                                        </button>
                                    </form>
                                </td>
                            </tr>

                            <!-- DETAIL/ACCORDION ROW (Inline Edit Form) -->
                            <tr class="detail-row collapse" id="details-{{ project.id }}">
                                <td colspan="5" class="p-4 bg-white">
                                    <form action="{{ url_for('edit', id=project.id) }}" method="POST" novalidate>
                                        <div class="accordion" id="accordion-{{ project.id }}">
                                            <!-- General Info Accordion -->
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#general-{{ project.id }}">
                                                        General Info
                                                    </button>
                                                </h2>
                                                <div id="general-{{ project.id }}" class="accordion-collapse collapse" data-bs-parent="#accordion-{{ project.id }}">
                                                    <div class="accordion-body">
                                                        <div class="row">
                                                            <div class="col-md-2">
                                                                <div class="mb-3">
                                                                    <label class="fw-bold">Project Name:</label>
                                                                    <input type="text" name="project" class="form-control form-control-sm" value="{{ project.project or '' }}">
                                                                </div>
                                                            </div>
                                                            <div class="col-md-4">
                                                                <div class="card p-3 text-center shadow-sm w-100">
                                                                    <small class="fw-bold d-block mb-2">Project Stage</small>
                                                                    <div class="d-flex flex-wrap justify-content-center gap-2">
                                                                        {% for field, stage, btn_class in options.project_stages %}
                                                                        <input type="radio" class="btn-check" name="project_stage" id="project_stage_{{ field }}" value="{{ field }}" {% if project.project_stage==field %}checked{% endif %}>
                                                                        <label class="btn btn-outline-{{ btn_class }} btn-sm flex-fill" for="project_stage_{{ field }}">
                                                                            {{ stage }}
                                                                        </label>
                                                                        {% endfor %}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-12">
                                                                <div class="mb-3">
                                                                    <label class="fw-bold">Description:</label>
                                                                    <textarea name="description" class="form-control form-control-sm" rows="4">{{ project.description or '' }}</textarea>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Cognitive Features Accordion -->
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#cognitive-{{ project.id }}">
                                                        Cognitive Features
                                                    </button>
                                                </h2>
                                                <div id="cognitive-{{ project.id }}" class="accordion-collapse collapse" data-bs-parent="#accordion-{{ project.id }}">
                                                    <div class="accordion-body">
                                                        <div class="accordion" id="cognitive-subgroups-{{ project.id }}">
                                                            <!-- Cognitive State -->
                                                            <div class="accordion-item">
                                                                <h2 class="accordion-header">
                                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#cognitive-state-{{ project.id }}">
                                                                        Cognitive State
                                                                    </button>
                                                                </h2>
                                                                <div id="cognitive-state-{{ project.id }}" class="accordion-collapse collapse" data-bs-parent="#cognitive-subgroups-{{ project.id }}">
                                                                    <div class="accordion-body">
                                                                        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
                                                                            {% for field, label in options.cognitive_del %}
                                                                            {{ macro.render_feature(field, label, project.feature_needs) }}
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <!-- Drowsiness & Sleep Detection -->
                                                            <div class="accordion-item">
                                                                <h2 class="accordion-header">
                                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#drowsiness-{{ project.id }}">
                                                                        Drowsiness & Sleep Detection
                                                                    </button>
                                                                </h2>
                                                                <div id="drowsiness-{{ project.id }}" class="accordion-collapse collapse" data-bs-parent="#cognitive-subgroups-{{ project.id }}">
                                                                    <div class="accordion-body">
                                                                        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
                                                                            {% for field, label in options.cognitive_dil %}
                                                                            {{ macro.render_feature(field, label, project.feature_needs) }}
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div> <!-- End Cognitive Sub-Accordion -->
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Visual Recognition Features Accordion -->
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#visual-{{ project.id }}">
                                                        Visual Recognition Features
                                                    </button>
                                                </h2>
                                                <div id="visual-{{ project.id }}" class="accordion-collapse collapse" data-bs-parent="#accordion-{{ project.id }}">
                                                    <div class="accordion-body">
                                                        <div class="accordion" id="visual-subgroups-{{ project.id }}">
                                                            <!-- Gestures & Activity -->
                                                            <div class="accordion-item">
                                                                <h2 class="accordion-header">
                                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#gestures-{{ project.id }}">
                                                                        Gestures & Activity
                                                                    </button>
                                                                </h2>
                                                                <div id="gestures-{{ project.id }}" class="accordion-collapse collapse" data-bs-parent="#visual-subgroups-{{ project.id }}">
                                                                    <div class="accordion-body">
                                                                        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
                                                                            {% for field, label in options.visual_activity %}
                                                                            {{ macro.render_feature(field, label, project.feature_needs) }}
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <!-- Mouth Activity -->
                                                            <div class="accordion-item">
                                                                <h2 class="accordion-header">
                                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#mouth-{{ project.id }}">
                                                                        Mouth Activity
                                                                    </button>
                                                                </h2>
                                                                <div id="mouth-{{ project.id }}" class="accordion-collapse collapse" data-bs-parent="#visual-subgroups-{{ project.id }}">
                                                                    <div class="accordion-body">
                                                                        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
                                                                            {% for field, label in options.visual_mouth %}
                                                                            {{ macro.render_feature(field, label, project.feature_needs) }}
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <!-- Object Detection -->
                                                            <div class="accordion-item">
                                                                <h2 class="accordion-header">
                                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#object-{{ project.id }}">
                                                                        Object Detection
                                                                    </button>
                                                                </h2>
                                                                <div id="object-{{ project.id }}" class="accordion-collapse collapse" data-bs-parent="#visual-subgroups-{{ project.id }}">
                                                                    <div class="accordion-body">
                                                                        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
                                                                            {% for field, label in options.visual_object %}
                                                                            {{ macro.render_feature(field, label, project.feature_needs) }}
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <!-- Driver Attention State -->
                                                            <div class="accordion-item">
                                                                <h2 class="accordion-header">
                                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#driver-{{ project.id }}">
                                                                        Driver Attention State
                                                                    </button>
                                                                </h2>
                                                                <div id="driver-{{ project.id }}" class="accordion-collapse collapse" data-bs-parent="#visual-subgroups-{{ project.id }}">
                                                                    <div class="accordion-body">
                                                                        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
                                                                            {% for field, label in options.visual_das %}
                                                                            {{ macro.render_feature(field, label, project.feature_needs) }}
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <!-- Face Occlusion Detection (FOD) -->
                                                            <div class="accordion-item">
                                                                <h2 class="accordion-header">
                                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#fod-{{ project.id }}">
                                                                        Face Occlusion Detection (FOD)
                                                                    </button>
                                                                </h2>
                                                                <div id="fod-{{ project.id }}" class="accordion-collapse collapse" data-bs-parent="#visual-subgroups-{{ project.id }}">
                                                                    <div class="accordion-body">
                                                                        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
                                                                            {% for field, label in options.visual_fod %}
                                                                            {{ macro.render_feature(field, label, project.feature_needs) }}
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <!-- Seat Occupancy Detection (SOD) -->
                                                            <div class="accordion-item">
                                                                <h2 class="accordion-header">
                                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sod-{{ project.id }}">
                                                                        Seat Occupancy Detection (SOD)
                                                                    </button>
                                                                </h2>
                                                                <div id="sod-{{ project.id }}" class="accordion-collapse collapse" data-bs-parent="#visual-subgroups-{{ project.id }}">
                                                                    <div class="accordion-body">
                                                                        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
                                                                            {% for field, label in options.visual_sod %}
                                                                            {{ macro.render_feature(field, label, project.feature_needs) }}
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <!-- Identity & Spoofing Detection -->
                                                            <div class="accordion-item">
                                                                <h2 class="accordion-header">
                                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#identity-{{ project.id }}">
                                                                        Identity & Spoofing Detection
                                                                    </button>
                                                                </h2>
                                                                <div id="identity-{{ project.id }}" class="accordion-collapse collapse" data-bs-parent="#visual-subgroups-{{ project.id }}">
                                                                    <div class="accordion-body">
                                                                        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
                                                                            {% for field, label in options.visual_id %}
                                                                            {{ macro.render_feature(field, label, project.feature_needs) }}
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div> <!-- End Visual Sub-Accordion -->
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Core Features Accordion -->
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#core-{{ project.id }}">
                                                        Core Features
                                                    </button>
                                                </h2>
                                                <div id="core-{{ project.id }}" class="accordion-collapse collapse" data-bs-parent="#accordion-{{ project.id }}">
                                                    <div class="accordion-body">
                                                        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
                                                            {% for field, label in options.core_features %}
                                                            {{ macro.render_feature(field, label, project.feature_needs) }}
                                                            {% endfor %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Utility Features Accordion -->
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#utility-{{ project.id }}">
                                                        Utility Features
                                                    </button>
                                                </h2>
                                                <div id="utility-{{ project.id }}" class="accordion-collapse collapse" data-bs-parent="#accordion-{{ project.id }}">
                                                    <div class="accordion-body">
                                                        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
                                                            {% for field, label in options.utility_features %}
                                                            {{ macro.render_feature(field, label, project.feature_needs) }}
                                                            {% endfor %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Standards Compliance Accordion -->
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#standards-{{ project.id }}">
                                                        Standards Compliance
                                                    </button>
                                                </h2>
                                                <div id="standards-{{ project.id }}" class="accordion-collapse collapse" data-bs-parent="#accordion-{{ project.id }}">
                                                    <div class="accordion-body">
                                                        <div class="accordion" id="standards-sub-accordion-{{ project.id }}">
                                                            <!-- ISO 26262 Sub-Accordion -->
                                                            <div class="accordion-item">
                                                                <h2 class="accordion-header">
                                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#iso26262-{{ project.id }}">
                                                                        ISO 26262 Compliance
                                                                    </button>
                                                                </h2>
                                                                <div id="iso26262-{{ project.id }}" class="accordion-collapse collapse" data-bs-parent="#standards-sub-accordion-{{ project.id }}">
                                                                    <div class="accordion-body">
                                                                        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
                                                                            <div class="col">
                                                                                <div class="card p-3 text-center shadow-sm">
                                                                                    <small class="fw-bold d-block mb-2">ISO 26262 VERSION</small>
                                                                                    {{ macro.render_dropdown('iso26262_version', options.iso26262_version_dropdown, project['iso26262_version'] or 'N/A', false, '', 'class="form-select"') }}
                                                                                </div>
                                                                            </div>
                                                                            <div class="col">
                                                                                <div class="card p-3 text-center shadow-sm">
                                                                                    <small class="fw-bold d-block mb-2">ISO 26262 LEVEL</small>
                                                                                    {{ macro.render_dropdown('iso26262_level', options.iso26262_level_dropdown, project['iso26262_level'] or 'N/A', false, '', 'class="form-select"') }}
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <!-- ASPICE Sub-Accordion -->
                                                            <div class="accordion-item">
                                                                <h2 class="accordion-header">
                                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#aspice-{{ project.id }}">
                                                                        ASPICE Compliance
                                                                    </button>
                                                                </h2>
                                                                <div id="aspice-{{ project.id }}" class="accordion-collapse collapse" data-bs-parent="#standards-sub-accordion-{{ project.id }}">
                                                                    <div class="accordion-body">
                                                                        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
                                                                            <div class="col">
                                                                                <div class="card p-3 text-center shadow-sm">
                                                                                    <small class="fw-bold d-block mb-2">ASPICE VERSION</small>
                                                                                    {{ macro.render_dropdown('aspice_version', options.aspice_version_dropdown, project['aspice_version'] or 'N/A', false, '', 'class="form-select"') }}
                                                                                </div>
                                                                            </div>
                                                                            <div class="col">
                                                                                <div class="card p-3 text-center shadow-sm">
                                                                                    <small class="fw-bold d-block mb-2">ASPICE LEVEL</small>
                                                                                    {{ macro.render_dropdown('aspice_level', options.aspice_level_dropdown, project['aspice_level'] or 'N/A', false, '', 'class="form-select"') }}
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <!-- ISO 21434 & ISO 21448 Sub-Accordion -->
                                                            <div class="accordion-item">
                                                                <h2 class="accordion-header">
                                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#iso214xx-{{ project.id }}">
                                                                        ISO 21434 & ISO 21448 Compliance
                                                                    </button>
                                                                </h2>
                                                                <div id="iso214xx-{{ project.id }}" class="accordion-collapse collapse" data-bs-parent="#standards-sub-accordion-{{ project.id }}">
                                                                    <div class="accordion-body">
                                                                        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
                                                                            <div class="col">
                                                                                <div class="card p-3 text-center shadow-sm">
                                                                                    <small class="fw-bold d-block mb-2">ISO 21434 VERSION</small>
                                                                                    {{ macro.render_dropdown('iso21434', options.iso21434_dropdown, project['iso21434'] or 'N/A', false, '', 'class="form-select"') }}
                                                                                </div>
                                                                            </div>
                                                                            <div class="col">
                                                                                <div class="card p-3 text-center shadow-sm">
                                                                                    <small class="fw-bold d-block mb-2">ISO 21448 VERSION</small>
                                                                                    {{ macro.render_dropdown('iso21448', options.iso21448_dropdown, project['iso21448'] or 'N/A', false, '', 'class="form-select"') }}
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Regulatory Compliance Accordion -->
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#regulation-{{ project.id }}">
                                                        Regulatory Compliance
                                                    </button>
                                                </h2>
                                                <div id="regulation-{{ project.id }}" class="accordion-collapse collapse" data-bs-parent="#accordion-{{ project.id }}">
                                                    <div class="accordion-body">
                                                        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
                                                            {% for field, label in options.regulations %}
                                                            {{ macro.render_binary_options(field, label, project) }}
                                                            {% endfor %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- SoC/Platform Accordion -->
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#soc_platform-{{ project.id }}">
                                                        SoC/Platform
                                                    </button>
                                                </h2>
                                                <div id="soc_platform-{{ project.id }}" class="accordion-collapse collapse" data-bs-parent="#accordion-{{ project.id }}">
                                                    <div class="accordion-body">
                                                        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
                                                            {% for field, label in options.hardware %}
                                                            {{ macro.render_binary_options(field, label, project) }}
                                                            {% endfor %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Operating System Accordion -->
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#os-{{ project.id }}">
                                                        Operating System
                                                    </button>
                                                </h2>
                                                <div id="os-{{ project.id }}" class="accordion-collapse collapse" data-bs-parent="#accordion-{{ project.id }}">
                                                    <div class="accordion-body">
                                                        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
                                                            {% for field, label in options.operating_systems %}
                                                            {{ macro.render_binary_options(field, label, project) }}
                                                            {% endfor %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Packaging Configuration Accordion -->
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#packaging-{{ project.id }}">
                                                        Packaging Configuration
                                                    </button>
                                                </h2>
                                                <div id="packaging-{{ project.id }}" class="accordion-collapse collapse" data-bs-parent="#accordion-{{ project.id }}">
                                                    <div class="accordion-body">
                                                        <!-- OMS/DMS Selection (Updated Field Name: "oms_dms") -->
                                                        <div class="card p-3 text-center shadow-sm mb-3">
                                                            <small class="fw-bold d-block mb-2">OMS/DMS Selection</small>
                                                            <select name="oms_dms" class="form-select form-select-sm">
                                                                <option value="OMS" {% if project.oms_dms=="OMS" %}selected{% endif %}>OMS</option>
                                                                <option value="DMS" {% if project.oms_dms=="DMS" %}selected{% endif %}>DMS</option>
                                                                <option value="BOTH" {% if project.oms_dms=="BOTH" %}selected{% endif %}>BOTH</option>
                                                            </select>
                                                        </div>
                                                        <!-- Table for Other Camera Settings -->
                                                        <div class="table-responsive">
                                                            <table class="table table-bordered table-hover align-middle text-center" style="table-layout: auto; width: auto;">
                                                                <thead class="table-light">
                                                                    <tr>
                                                                        <th class="text-start">Configuration</th>
                                                                        {% for field, label in options.camera_settings %}
                                                                        {% if field not in ["oms_dms"] %}
                                                                        <th class="text-center small px-2" style="writing-mode: vertical-rl; transform: rotate(180deg); white-space: nowrap; vertical-align: middle; min-width: 50px;">
                                                                            {{ label }}
                                                                        </th>
                                                                        {% endif %}
                                                                        {% endfor %}
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr>
                                                                        <td class="fw-bold text-start">Required</td>
                                                                        {% for field, label in options.camera_settings %}
                                                                        {% if field not in ["oms_dms"] %}
                                                                        <td class="text-center">
                                                                            <input type="checkbox" name="{{ field }}" value="true" {% if project[field] %}checked{% endif %}>
                                                                        </td>
                                                                        {% endif %}
                                                                        {% endfor %}
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Camera Configuration Accordion -->
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#camera-{{ project.id }}">
                                                        Camera Configuration
                                                    </button>
                                                </h2>
                                                <div id="camera-{{ project.id }}" class="accordion-collapse collapse" data-bs-parent="#accordion-{{ project.id }}">
                                                    <div class="accordion-body d-flex justify-content-center">
                                                        <div class="card p-3 text-center shadow-sm mb-3">
                                                            <small class="fw-bold d-block mb-1">Camera Locations</small>
                                                            <div class="position-relative mx-auto" style="width: 100%; max-width: 1024px;">
                                                                <img src="{{ url_for('static', filename='cabin.png') }}" class="img-fluid d-block mx-auto" alt="Camera Locations">

                                                                {% set cameras = {
                                                                "1": {"left": 460, "top": 70,  "width": 120, "height": 77},
                                                                "2": {"left": 442, "top": 180, "width": 155, "height": 49},
                                                                "3": {"left": 294, "top": 360, "width": 58,  "height": 28},
                                                                "4": {"left": 438, "top": 320, "width": 166, "height": 68},
                                                                "5": {"left": 219, "top": 245, "width": 63,  "height": 122}
                                                                } %}

                                                                {% for camera_id, data in cameras.items() %}
                                                                <div id="camera_{{ camera_id }}_container"
                                                                     class="position-absolute camera-container"
                                                                     style="left: {{ data.left }}px; top: {{ data.top }}px; width: {{ data.width }}px; height: {{ data.height }}px; cursor: pointer;"
                                                                     onclick="toggleCameraImage('{{ camera_id }}')">

                                                                    <input type="checkbox" id="camera_{{ camera_id }}" name="camera_{{ camera_id }}" class="d-none"
                                                                           {% if project[camera_id]==True %}checked{% endif %}>
                                                                    <div id="transparent_box_{{ camera_id }}" class="transparent-box"></div>
                                                                </div>
                                                                {% endfor %}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>


                                                <!-- Seating Positions Accordion -->
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#seating-{{ project.id }}">
                                                            Seating Positions
                                                        </button>
                                                    </h2>
                                                    <div id="seating-{{ project.id }}" class="accordion-collapse collapse" data-bs-parent="#accordion-{{ project.id }}">
                                                        <div class="accordion-body d-flex justify-content-center">
                                                            <div class="card p-3 text-center shadow-sm mb-3">
                                                                <small class="fw-bold d-block mb-1">Seating Positions</small>
                                                                <div class="position-relative mx-auto" style="width: 100%; max-width: 800px;">
                                                                    <img src="{{ url_for('static', filename='seating_positions.png') }}" class="img-fluid d-block mx-auto" alt="Seating Positions">

                                                                    {% set seat_mapping = {
                                                                    "seat_driver":  (25, 51), "seat_2nd_row_drv":   (25, 38), "seat_3rd_row_drv":   (25, 25),
                                                                    "seat_mid":     (38, 51), "seat_2nd_row_mid":   (38, 38), "seat_3rd_row_mid":   (38, 25),
                                                                    "seat_pass":    (51, 51), "seat_2nd_row_pass":  (51, 38), "seat_3rd_row_pass":  (51, 25)
                                                                    } %}

                                                                    {% for seat_id, (top, left) in seat_mapping.items() %}
                                                                    <div class="position-absolute seat-container"
                                                                         style="top: {{ top }}%; left: {{ left }}%; width: 40px; height: 40px; cursor: pointer;"
                                                                         onclick="toggleSeat('{{ seat_id }}', '{{ project.id }}')">

                                                                        <!-- Checkbox -->
                                                                        <input type="checkbox" id="{{ seat_id }}_{{ project.id }}" name="{{ seat_id }}" class="d-none"
                                                                               value="true" {% if project[seat_id] %}checked{% endif %}>

                                                                        <!-- Seat Image -->
                                                                        <img id="seat_img_{{ seat_id }}_{{ project.id }}"
                                                                             src="{{ url_for('static', filename='human.png') }}"
                                                                             class="seat-image"
                                                                             style="width: 200%; height: 200%; visibility: {% if project[seat_id] %}visible{% else %}hidden{% endif %};"
                                                                             alt="Seat">
                                                                    </div>
                                                                    {% endfor %}
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Save Changes Button -->
                                                    <button type="submit" class="btn btn-primary btn-sm mt-3 save-btn">
                                                        <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                                                        Save Changes
                                                    </button>
                                                </div>
                                    </form>
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="5" class="text-center py-4 text-muted">No projects found</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/scripts.js') }}"></script>

</body>
</html>
